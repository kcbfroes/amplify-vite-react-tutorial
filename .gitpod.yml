# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/introduction/learn-gitpod/gitpod-yaml)
# and commit this file to your remote git repository to share the goodness with others.

# Learn more from ready-to-use templates: https://www.gitpod.io/docs/introduction/getting-started/quickstart

image:
  file: .gitpod.DockerFile

tasks:
  - name: NPM
    init: npm install && npm run build
    command: |
      gp sync-await amplify
      npm run dev
        
  - name: Amplify Setup
    command: |
      echo "Amplify Setup"
      echo ""
      lenSAK=${#AWS_SECRET_ACCESS_KEY}
      lenSessionToken=${#AWS_SESSION_TOKEN}
      echo "Environment Variables..."
      echo "   AWS_ACCESS_KEY_ID: $AWS_ACCESS_KEY_ID"
      if [ "$lenSAK" -eq 0 ]; then
        echo "   AWS_SECRET_ACCESS_KEY is NOT VALUED!"
      else
        echo "   AWS_SECRET_ACCESS_KEY: $lenSAK characters long"
      fi 
      if [ "$lenSessionToken" -eq 0 ]; then
        echo "   AWS_SESSION_TOKEN is NOT VALUED!"
      else
        echo "   AWS_SESSION_TOKEN: $lenSessionToken characters long"
      fi 
      echo "   AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION"
      echo ""
      if [ ! -d "$HOME/.aws" ]; then
        echo "About to create the AWS Credential information"
        bash createAWSCredentials.bash
        echo "AWS Credentials Completed"
      fi
      gp sync-done amplify

ports:
  - port: 5173
    onOpen: open-preview
